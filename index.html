<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Clinical Tools – Test Sandbox</title>

<!-- ===== MINIMAL THEME ===== -->
<style>
:root{
  --bg:#0f1113;
  --card:#16191d;
  --inner:#0b0d10;
  --border:#262a30;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#3b82f6;
  --success:#064e3b;
  --warn:#78350f;
  --info:#1e3a8a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

main{
  max-width:1000px;
  margin:24px auto;
  padding:16px;
}

h1{
  font-size:1.6rem;
  margin-bottom:6px;
}

.sub{
  color:var(--muted);
  font-size:.9rem;
  margin-bottom:20px;
}

/* ===== TOOL CARD ===== */
.tool{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  margin-bottom:14px;
  overflow:hidden;
}

.tool summary{
  list-style:none;
  padding:16px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}

.tool summary::-webkit-details-marker{display:none}

.tool-title{font-weight:600}
.tool-sub{font-size:.8rem;color:var(--muted)}

.tool-body{
  padding:16px;
  border-top:1px solid var(--border);
}

/* ===== UTIL ===== */
.hidden{display:none}

/* ===== BUTTON ===== */
.primary-btn{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

.primary-btn:hover{opacity:.9}
</style>

<style>
/* ===== CHA2DS2-VASc BUTTON STYLES ===== */

.cha-options{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.cha-btn{
  padding:10px 16px;
  border-radius:999px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
  font-weight:600;
  cursor:pointer;
  transition:all .15s ease;
}

/* THIS is the highlight */
.cha-btn.selected{
  background:#2563eb;
  border-color:#93c5fd;
  color:#ffffff;
  box-shadow:0 0 0 2px rgba(59,130,246,.35);
}

.cha-result{
  margin-top:14px;
  padding:14px;
  border-radius:12px;
  font-weight:700;
}

.cha-success{background:#064e3b;color:#d1fae5}
.cha-warn{background:#78350f;color:#fde68a}
</style>

</head>

<body>

<main>

<h1>Clinical Tools – Test</h1>
<div class="sub">
  Isolated sandbox for testing new tools safely
</div>

<!-- =================================================== -->
<!-- PASTE / TEST NEW TOOLS BELOW THIS LINE ONLY -->
<!-- =================================================== -->

<!-- ================= CHA₂DS₂-VASc SCORE ================= -->

<details class="tool" data-system="cardio" open>
  <summary>
    <div>
      <div class="tool-title">CHA₂DS₂-VASc Score</div>
      <div class="tool-sub">Stroke risk & anticoagulation in Atrial Fibrillation</div>
    </div>
    <div>▾</div>
  </summary>

  <div class="tool-body">

    <!-- SEX -->
    <div class="step">
      <div class="step-title">Sex</div>
      <div class="cha-options" data-group="sex">
        <button class="cha-btn" data-value="0">Male</button>
        <button class="cha-btn" data-value="1">Female</button>
      </div>
    </div>

    <!-- RISK FACTORS -->
    <div class="step">
      <div class="step-title">Risk factors</div>
      <div class="cha-options">
        <button class="cha-btn" data-value="1">Heart failure</button>
        <button class="cha-btn" data-value="1">Hypertension</button>
        <button class="cha-btn" data-value="1">Diabetes</button>
        <button class="cha-btn" data-value="1">Vascular disease</button>
      </div>
    </div>

    <!-- AGE -->
    <div class="step">
      <div class="step-title">Age</div>
      <div class="cha-options" data-group="age">
        <button class="cha-btn" data-value="0">&lt; 65 years</button>
        <button class="cha-btn" data-value="1">65–74 years</button>
        <button class="cha-btn" data-value="2">≥ 75 years</button>
      </div>
    </div>

    <!-- STROKE -->
    <div class="step">
      <div class="step-title">Stroke / TIA / Thromboembolism</div>
      <div class="cha-options" data-group="stroke">
        <button class="cha-btn" data-value="2">Present</button>
        <button class="cha-btn selected" data-value="0">Absent</button>
      </div>
    </div>

    <!-- RESULT -->
    <div id="chaResult" class="result success">
      CHA₂DS₂-VASc Score = 0<br>
      Low risk. No anticoagulation required.
    </div>

  </div>
</details>

<script>
/* ================= CHA₂DS₂-VASc LOGIC ================= */

const chaButtons = document.querySelectorAll('.cha-btn');

chaButtons.forEach(btn => {
  btn.addEventListener('click', () => {

    const group = btn.parentElement.dataset.group;

    // SINGLE-SELECT GROUPS (Sex, Age, Stroke)
    if (group) {
      btn.parentElement.querySelectorAll('.cha-btn')
        .forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    }
    // MULTI-SELECT GROUP (Risk factors)
    else {
      btn.classList.toggle('selected');
    }

    calculateCHA();
  });
});

function calculateCHA(){
  let score = 0;
  let isFemale = false;

  document.querySelectorAll('.cha-btn.selected').forEach(b => {
    const val = Number(b.dataset.value);
    score += val;

    if (
      b.parentElement.dataset.group === 'sex' &&
      val === 1
    ) {
      isFemale = true;
    }
  });

  const r = document.getElementById('chaResult');
  let msg = '';
  let cls = 'success';

  /*
    GUIDELINE-CORRECT INTERPRETATION

    Male:
      0 → No Rx
      1 → Consider
      ≥2 → Start

    Female:
      1 → No Rx (sex only)
      2 → Consider
      ≥3 → Start
  */

  if (
    (!isFemale && score === 0) ||
    (isFemale && score === 1)
  ) {
    msg = 'Low risk. No anticoagulation required.';
    cls = 'success';

  } else if (
    (!isFemale && score === 1) ||
    (isFemale && score === 2)
  ) {
    msg = 'Moderate risk. Consider anticoagulation.';
    cls = 'warn';

  } else {
    msg = 'High risk. Strong indication to START anticoagulation.';
    cls = 'warn';
  }

  r.className = 'result ' + cls;
  r.innerHTML = `CHA₂DS₂-VASc Score = <b>${score}</b><br>${msg}`;
}
</script>

<!-- =================================================== -->
<!-- PASTE / TEST NEW TOOLS ABOVE THIS LINE ONLY -->
<!-- =================================================== -->

</main>

<!-- ===== TOOL-SPECIFIC JS GOES BELOW ===== -->
<script>
// write JS for test tools here
</script>

</body>
</html>