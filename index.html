<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Clinical Tools – Test Sandbox</title>

<!-- ===== MINIMAL THEME ===== -->
<style>
:root{
  --bg:#0f1113;
  --card:#16191d;
  --inner:#0b0d10;
  --border:#262a30;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#3b82f6;
  --success:#064e3b;
  --warn:#78350f;
  --info:#1e3a8a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

main{
  max-width:1000px;
  margin:24px auto;
  padding:16px;
}

h1{
  font-size:1.6rem;
  margin-bottom:6px;
}

.sub{
  color:var(--muted);
  font-size:.9rem;
  margin-bottom:20px;
}

/* ===== TOOL CARD ===== */
.tool{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  margin-bottom:14px;
  overflow:hidden;
}

.tool summary{
  list-style:none;
  padding:16px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}

.tool summary::-webkit-details-marker{display:none}

.tool-title{font-weight:600}
.tool-sub{font-size:.8rem;color:var(--muted)}

.tool-body{
  padding:16px;
  border-top:1px solid var(--border);
}

/* ===== UTIL ===== */
.hidden{display:none}

/* ===== BUTTON ===== */
.primary-btn{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

.primary-btn:hover{opacity:.9}
</style>

</head>

<body>

<main>

<h1>Clinical Tools – Test</h1>
<div class="sub">
  Isolated sandbox for testing new tools safely
</div>

<!-- =================================================== -->
<!-- PASTE / TEST NEW TOOLS BELOW THIS LINE ONLY -->
<!-- =================================================== -->

<!-- Example placeholder tool -->
<details class="tool">
  <summary>
    <div>
      <div class="tool-title">Test Tool</div>
      <div class="tool-sub">Temporary sandbox</div>
    </div>
    <div>▾</div>
  </summary>

  <div class="tool-body">
    <button class="primary-btn">Dummy Action</button>
  </div>
</details>

<!-- ================= CHA2DS2-VASc SCORE (AUTO) ================= -->

<details class="tool" data-system="cardio">
  <summary>
    <div>
      <div class="tool-title">CHA₂DS₂-VASc Score</div>
      <div class="tool-sub">Auto-calculated stroke risk in AF</div>
    </div>
    <div>▾</div>
  </summary>

  <div class="tool-body">

    <div class="step">
      <div class="step-title">Select risk factors</div>

      <div class="options" style="flex-wrap:wrap">

        <!-- CORE -->
        <button onclick="cha.toggle(this,'hf',1)">Heart failure</button>
        <button onclick="cha.toggle(this,'htn',1)">Hypertension</button>
        <button onclick="cha.toggle(this,'dm',1)">Diabetes</button>
        <button onclick="cha.toggle(this,'vasc',1)">Vascular disease</button>
        <button onclick="cha.toggle(this,'stroke',2)">Stroke / TIA / TE</button>

        <!-- AGE (exclusive) -->
        <button onclick="cha.setAge(this,2)">Age ≥ 75 years</button>
        <button onclick="cha.setAge(this,1)">Age 65–74 years</button>

        <!-- SEX -->
        <button onclick="cha.toggleSex(this)">Female sex</button>

      </div>
    </div>

    <!-- RESULT -->
    <div id="cha-result" class="result hidden"></div>

    <!-- INTERPRETATION -->
    <div id="cha-info" class="monitor hidden"></div>

  </div>
</details>

<script>
const cha = {
  score: 0,
  age: 0,
  female: false,
  items: {},

  toggle(btn, key, val){
    if(btn.classList.contains('selected')){
      btn.classList.remove('selected');
      this.score -= val;
      delete this.items[key];
    } else {
      btn.classList.add('selected');
      this.score += val;
      this.items[key] = val;
    }
    this.update();
  },

  setAge(btn, val){
    // remove both age selections
    document.querySelectorAll('[onclick^="cha.setAge"]').forEach(b=>{
      b.classList.remove('selected');
    });

    this.score -= this.age;
    this.age = val;
    this.score += val;

    btn.classList.add('selected');
    this.update();
  },

  toggleSex(btn){
    if(btn.classList.contains('selected')){
      btn.classList.remove('selected');
      this.female = false;
      this.score -= 1;
    } else {
      btn.classList.add('selected');
      this.female = true;
      this.score += 1;
    }
    this.update();
  },

  update(){
    const r = document.getElementById('cha-result');
    const info = document.getElementById('cha-info');
    const s = this.score;

    if(s < 0){
      r.classList.add('hidden');
      info.classList.add('hidden');
      return;
    }

    let msg = '';
    let cls = 'info';

    if(this.female){
      if(s === 1){
        msg = 'Female sex alone → <b>No anticoagulation</b>';
        cls = 'info';
      } else if(s === 2){
        msg = 'Consider anticoagulation based on clinical context.';
        cls = 'warn';
      } else if(s >= 3){
        msg = '<b>Start oral anticoagulation</b>';
        cls = 'success';
      }
    } else {
      if(s === 0){
        msg = 'No anticoagulation required.';
        cls = 'info';
      } else if(s === 1){
        msg = 'Consider anticoagulation.';
        cls = 'warn';
      } else {
        msg = '<b>Start oral anticoagulation</b>';
        cls = 'success';
      }
    }

    r.className = 'result ' + cls;
    r.innerHTML = `<strong>CHA₂DS₂-VASc = ${s}</strong><br>${msg}`;
    r.classList.remove('hidden');

    info.innerHTML = `
      <b>Guideline note:</b><br>
      • Men: ≥2 → OAC indicated<br>
      • Women: ≥3 → OAC indicated<br>
      • Female sex alone is <b>not</b> an indication
    `;
    info.classList.remove('hidden');
  }
};
</script>

<!-- =================================================== -->
<!-- PASTE / TEST NEW TOOLS ABOVE THIS LINE ONLY -->
<!-- =================================================== -->

</main>

<!-- ===== TOOL-SPECIFIC JS GOES BELOW ===== -->
<script>
// write JS for test tools here
</script>

</body>
</html>
